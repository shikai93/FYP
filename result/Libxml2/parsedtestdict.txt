#define WITH_PRINT

That's a bit nasty but the output is fine and it doesn't take hours there is a small but sufficient number of duplicates, and we have ":xxx" and full QNames in the last NB_STRINGS_NS values

Now do the same with the second pool of strings

really should not happen

really should not happen

This tests the sub-dictionary support

Fill in NB_STRINGS_MIN, at this point the dictionary should not grow and we allocate all those doing the fast key computations All the strings are based on a different seeds subset so we know they are allocated in the main dictionary, not coming from the parent

":foo" like strings2

"a:foo" like strings2

At this point allocate all the strings the dictionary will grow in the process, reallocate more string tables and switch to the better key generator

Now we can start to test things, first that all strings2 belongs to the dict, and that none of them was actually allocated in the parent

Also verify that all strings from the parent are seen from the subdict

Then that another lookup to the string in sub will return the same

But also that any lookup for a string in the parent will be provided as in the parent

check the QName lookups

check the QName lookups for strings from the parent

Test a single dictionary

Fill in NB_STRINGS_MIN, at this point the dictionary should not grow and we allocate all those doing the fast key computations

":foo" like strings1

"a:foo" like strings1

At this point allocate all the strings the dictionary will grow in the process, reallocate more string tables and switch to the better key generator

Now we can start to test things, first that all strings1 belongs to the dict

Then that another lookup to the string will return the same

More complex, check the QName lookups

a

b

c

d

e

f

g

h

i

j

k

l

m

n

o

p

q

r

s

t

u

v

w

x

s a bit nasty but the output is fine and it doesn

:xxx

Out of memory while generating strings1\n

Out of memory while generating strings1\n

:

Out of memory while generating strings1\n

Out of memory while generating strings1\n

Out of memory while generating strings2\n

Out of memory while generating strings2\n

:

Out of memory while generating strings2\n

Out of memory while generating strings2\n

%s\n

%s\n

Out of memory while creating sub-dictionary\n

Failed lookup for '%s'\n

:foo

Failed lookup for '%s'\n

a:foo

Failed lookup for '%s'\n

Failed lookup for '%s'\n

Failed ownership failure for '%s'\n

Failed parent ownership failure for '%s'\n

Failed sub-ownership failure for '%s'\n

Failed re-lookup check for %d, '%s'\n

Failed parent string lookup check for %d, '%s'\n

:

Failed lookup check for '%s':'%s'\n

:

Failed parent lookup check for '%s':'%s'\n

Out of memory while creating dictionary\n

Failed lookup for '%s'\n

:foo

Failed lookup for '%s'\n

a:foo

Failed lookup for '%s'\n

Failed lookup for '%s'\n

Failed ownership failure for '%s'\n

Failed re-lookup check for %d, '%s'\n

:

Failed lookup check for '%s':'%s'\n

dictionary tests succeeded %d strings\n

dictionary tests failed with %d errors\n

