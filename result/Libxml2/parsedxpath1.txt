section: XPath synopsis: Evaluate XPath expression and prints result node set. purpose: Shows how to evaluate XPath expression and register known namespaces in XPath context. usage:xpath1 <xml-file> <xpath-expr> [<known-ns-list>] test: ./xpath1 test3.xml '//child2' > xpath1.tmp ; diff xpath1.tmp xpath1.res ; rm xpath1.tmp author: Aleksey Sanin copy: see Copyright for the status of this software.

Parse command line and process file

Init libxml

Do the main job

Shutdown libxml

this is to debug memory for regression tests

usage: @name:the program name. Prints usage information.

execute_xpath_expression: @filename:the input XML filename. @xpathExpr:the xpath expression for evaluation. @nsList:the optional list of known namespaces in "<prefix1>=<href1> <prefix2>=href2> ..." format. Parses input XML file, evaluates XPath expression and prints results. Returns 0 on success and a negative value otherwise.

Load XML document

Create xpath evaluation context

Register namespaces from list (if any)

Evaluate xpath expression

Print results

Cleanup

register_namespaces: @xpathCtx:the pointer to an XPath context. @nsList:the list of known namespaces in "<prefix1>=<href1> <prefix2>=href2> ..." format. Registers namespaces from @nsList in @xpathCtx. Returns 0 on success and a negative value otherwise.

skip spaces

find prefix

find href

do register namespace

print_xpath_nodes: @nodes:the nodes set. @output:the output file handle. Prints the @nodes content to @output.

child2' > xpath1.tmp ; diff xpath1.tmp xpath1.res ; rm xpath1.tmp

//child2

Error: wrong number of arguments.\n

Usage: %s <xml-file> <xpath-expr> [<known-ns-list>]\n

where <known-ns-list> is a list of known namespaces\n

in \"<prefix1>=<href1> <prefix2>=href2> ...\" format\n

<prefix1>=<href1> <prefix2>=href2> ...

Error: unable to parse file \"%s\"\n

Error: unable to create new XPath context\n

Error: failed to register namespaces list \"%s\"\n

Error: unable to evaluate xpath expression \"%s\"\n

<prefix1>=<href1> <prefix2>=href2> ...

Error: unable to strdup namespaces list\n



\0

=

Error: invalid namespaces list format\n

\0



\0

Error: unable to register NS with prefix=\"%s\" and href=\"%s\"\n

Result (%d nodes):\n

= namespace \"%s\"=\"%s\" for node %s:%s\n

= namespace \"%s\"=\"%s\" for node %s\n

= element node \"%s:%s\"\n

= element node \"%s\"\n

= node \"%s\": type %d\n

XPath support not compiled in\n

