Copyright 1999-2016 The OpenSSL Project Authors. All Rights Reserved. Licensed under the OpenSSL license (the "License"). You may not use this file except in compliance with the License. You can obtain a copy in the file LICENSE in the source distribution or at https://www.openssl.org/source/license.html

Simple PKCS#7 processing functions

Check to see if a cipher exists and if so add S/MIME capabilities

Add SMIMECapabilities

Search for a digest matching SignerInfo digest type and if found copy across.

Check for no data and no content: no data to verify signature

This was originally "#if 0" because we thought that only old broken Netscape did this. It turns out that Authenticode uses this kind of "extended" PKCS7 format, and things like UEFI secure boot and tools like osslsigncode need it. In Authenticode the verification process is different, but the existing PKCs7 verification works.

Now verify the certificates

Check for revocation status here

Performance optimization: if the content is a memory BIO then store its contents in a temporary read only memory BIO. This avoids potentially large numbers of slow copies of data which will occur when reading from a read write memory BIO when signatures are calculated.

We now have to 'read' from p7bio to calculate digests etc.

Now Verify All Signatures

Collect all the signers together

If any certificates passed they take priority

Build a complete PKCS#7 enveloped data

Encrypt BIOs can't do BIO_gets() so add a buffer BIO

www.openssl.org/source/license.html

License

internal/cryptlib.h

#if 0

extended

smime_sign

Verify error:

read

