Copyright 2006-2016 The OpenSSL Project Authors. All Rights Reserved. Licensed under the OpenSSL license (the "License"). You may not use this file except in compliance with the License. You can obtain a copy in the file LICENSE in the source distribution or at https://www.openssl.org/source/license.html

Default callback for response generation.

TS_RESP_CTX management functions.

No EVP_MD_free method exists.

Ownership is lost.

Main entry method of the response generation.

Ownership will be returned to caller.

Initializes the variable part of the context.

Cleans up the variable part of the context.

Checks the format and content of the request.

Returns the TSA policy based on the requested and acceptable policies.

Check if the policy is acceptable.

Creates the TS_TST_INFO object based on the settings of the context.

Processing the extensions of the request.

The last argument was previously (void )ctx->extension_cb, but ISO C doesn't permit converting a function pointer to void . For lack of better information, I'm placing a NULL there instead. The callback can pick its own address out from the ctx anyway...

Functions for signing the TS_TST_INFO structure of the context.

Certificates to include in sc.

Ownership is lost.

Ownership is lost.

Call for side-effect of computing hash and caching extensions

Setting the issuer/serial if requested.

Ownership is lost.

Create new encapsulated NID_id_smime_ct_TSTInfo content.

Add encapsulated content to signed PKCS7 structure.

Ownership is lost.

Put "genTime_str" in GeneralizedTime format. We work around the restrictions imposed by rfc3280 (i.e. "GeneralizedTime values MUST NOT include fractional seconds") and OpenSSL related functions to meet the rfc3161 requirement: "GeneralizedTime syntax can include fraction-of-second details".

To make things a bit harder, X.690 | ISO/IEC 8825-1 provides the following restrictions for a DER-encoding, which OpenSSL (specifically ASN1_GENERALIZEDTIME_check() function) doesn't support: "The encoding MUST terminate with a "Z" (which means "Zulu" time). The decimal point element, if present, MUST be the point option ".". The fractional-seconds elements, if present, MUST omit all trailing 0's; if the elements correspond to 0, they MUST be wholly omitted, and the decimal point element also MUST be omitted."

Remove trailing zeros. The dot guarantees the exit condition of this loop even if all the digits are zero.

www.openssl.org/source/license.html

License

internal/cryptlib.h

ts_lcl.h

Error during serial number generation.

Time is not available.

Time is not available.

Unsupported extension.

Bad request format or system error.

Error during response

generation.

Bad request version.

Message digest algorithm is

not supported.

Superfluous message digest

parameter.

Bad message digest.

Requested policy is not

supported.

Error during TSTInfo

generation.

t permit converting a function pointer to void *. * For lack of better information, I

Error during signature

generation.

genTime_str

GeneralizedTime values MUST * NOT include fractional seconds

GeneralizedTime syntax can include * fraction-of-second details

%04d%02d%02d%02d%02d%02d

.%06ld

t * support: "The encoding MUST terminate with a "Z" (which means * "Zulu" time). The decimal point element, if present, MUST be the * point option ".". The fractional-seconds elements, if present, * MUST omit all trailing 0

0

.

Z

\0

